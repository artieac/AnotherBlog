@model AlwaysMoveForward.AnotherBlog.Web.Areas.Admin.Models.ManageBlogModel
@{
    Layout = "~/Areas/Admin/Views/Shared/_BlogLayout.cshtml";
    ViewBag.Common = Model.Common;
    ViewBag.AllowBlogChange = false;        
}
@section headerPlugins
{
    <script src="//tinymce.cachefly.net/4.1/tinymce.min.js"></script>
    <script>tinymce.init({
            plugins: "link",
            selector: 'textarea',
            menubar: "format insert edit",
            toolbar: "alignleft aligncenter alignright alignjustify fontsizeselect bullist numlist outdent indent blockquote undo redo link"
        });
    </script>
    <script src="/Scripts/Admin/ManageBlogPosts.js" type="text/javascript"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#saveButton").click(function () {
                $("#saveForm").submit();
            });
        });

        ManageBlogPosts.SetupAutoSaveTimer();
    </script>
}
<form id="changeBlogForm" action="/Admin/ManageBlog/EditPost/@Model.EntryList[0].Post.Id.ToString()">
    <input type="hidden" id="performSave" name="performSave" value="true" />
</form>
<input type="hidden" id="entryId" name="entryId" value="@Model.EntryList[0].Post.Id" />
<input type="hidden" id="autoSaveUrl" value="/api/Blog/@Model.Common.TargetBlog.SubFolder/BlogPost"/>
<div class="bodyContent">
    <div class="panel panel-primary editAreaContainer">
        <div class="panel-header">
            Edit Blog Post
        </div>
        <div>
            <br />
            <form id="saveForm" action="/Admin/ManageBlog/EditPost/@Model.Common.TargetBlog.SubFolder/@Model.EntryList[0].Post.Id.ToString()" method="post">
                <input type="hidden" id="performSave" name="performSave" value="true" />
                <div>
                    <label for="title" class="sr-only">Title</label>
                    <input type="text" id="title" name="title" value="@Model.EntryList[0].Post.Title" maxlength="50" class="form-control" placeholder="Title" required autofocus />
                </div>
                <div>
                    <input id='isPublished' name='isPublished' type='checkbox' @if (Model.EntryList[0].Post.IsPublished) { <text> checked </text>      } /> Is Published
                </div>
                <div>
                    <label for="entryText" class="sr-only">Entry Text</label>
                    <textarea id="entryText" name="entryText">@Model.EntryList[0].Post.EntryText</textarea>
                </div>
                @{
                    String tagsAsString = "";

                    if (Model.EntryList[0].Post != null)
                    {
                        if (Model.EntryList[0].Tags.Count > 0)
                        {
                            tagsAsString = Model.EntryList[0].Tags[0].Name;
                        }

                        for (int i = 1; i < Model.EntryList[0].Tags.Count; i++)
                        {
                            tagsAsString += "," + Model.EntryList[0].Tags[i].Name;
                        }
                    }
                }
                <div>
                    <label for="tagInput" class="sr-only">Tags</label>
                    <input type="text" id="tagInput" name="tagInput" value="@tagsAsString" class="form-control" placeholder="Tags" required />
                </div>
                <button type="button" class="btn btn-primary" id="saveButton" name="saveButton">Save</button>
            </form>
            <div style="display:none">
                <form id="blogEntryAjaxForm" action="/api/Blog/@Model.Common.TargetBlog.SubFolder/BlogPost/@Model.EntryList[0].Post.Id" method="post">
                    <input type="hidden" id="ajaxIsPublished" name="IsPublished" value="@if(Model.EntryList[0].Post.IsPublished==true){<text>on</text>}else{<text>off</text>}" />
                    <input type="hidden" id="ajaxTitle" name="Title" value="@Model.EntryList[0].Post.Title" />
                    <input type="hidden" id="ajaxEntryText" name="Text" value="@Model.EntryList[0].Post.EntryText" />
                    <input type="hidden" id="ajaxTagInput" name="Tags" value="@tagsAsString" />
                </form>
            </div>
            <div id="fileUploadSection">
                @Html.Partial("_FileUploadControl", @Model.Common)
            </div>
        </div>
    </div>
</div>
